# app/core/keywords.py
from typing import List, Dict, Any, Set # 导入 List, Dict, Any, Set

# 这是一个示例关键字库，您可以根据需求进行扩展
# 关键字不区分大小写

KEYWORDS_CONFIG: Dict[str, Dict[str, Any]] = {
    "课堂": {
        "场景描述": "课堂教学场景",
        "关键字": [
            # 名词与概念
            "作业", "考试", "测验", "期中", "期末", "学分", "绩点", "挂科",
            "复习", "预习", "提问", "回答", "讨论", "辩论", "演讲",
            "重点", "难点", "考点", "核心", "基础", "框架", "理论", "实践",
            "课程表", "教学大纲", "参考书", "教材", "PPT", "幻灯片", "讲义",
            "知识点", "概念", "定义", "公式", "定理", "定律", "推导", "证明",
            "实验", "实验报告", "数据", "图表", "模型", "案例", "分析",
            "小组讨论", "演示", "项目", "论文", "开题报告", "答辩",
            "截止日期", "ddl", "补交", "重修", "选课", "退课", "旁听",
            "办公室时间", "答疑", "辅导", "助教", "教授", "讲师", "同学",
            # 动词与短语
            "理解", "掌握", "应用", "分析", "总结", "归纳", "比较", "解释",
            "计算", "解决", "设计", "评估", "反思", "批判性思维",
            # 语义连接词（部分已在通用中定义，这里可放场景特有或高频的）
            "首先", "其次", "再次", "最后", "总而言之", "因此", "所以", "因为", "但是", "然而",
            "例如", "具体来说", "换句话说", "另一方面"
        ],
        "场景指示词": [
            "上课", "下课", "这节课", "今天我们讲", "打开课本", "翻到第几页", "做笔记",
            "听明白了吗", "有什么问题", "点名", "签到", "随堂测试", "课堂作业",
            "老师说", "教授强调", "同学们注意", "黑板", "投影仪", "教室", "自习室", "图书馆"
        ]
    },
    "会议": {
        "场景描述": "各类会议场景",
        "关键字": [
            # 会议要素
            "议程", "议题", "主题", "目标", "目的", "范围", "背景",
            "决议", "决策", "结论", "共识", "投票", "表决",
            "行动项", "任务分配", "负责人", "执行人", "截止时间", "时间节点", "里程碑",
            "会议纪要", "记录", "备忘", "摘要", "要点",
            "下一步", "后续行动", "跟进事项", "待办事项",
            "预算", "成本", "资源", "投入产出", "风险评估", "应急预案",
            "策略", "方针", "路线图", "商业模式", "市场分析", "竞品分析",
            "季度报告", "年度总结", "项目评审", "进展汇报", "绩效考核",
            "演示文稿", "数据图表", "提案", "建议", "反馈", "意见",
            "主持人", "参会者", "利益相关者", "客户", "供应商", "合作伙伴",
            # 动词与短语
            "讨论", "分析", "审查", "批准", "协商", "协调", "同步信息",
            "头脑风暴", "集思广益", "达成一致", "提出异议", "澄清", "确认",
            # 语义连接词
            "考虑到", "鉴于", "基于此", "总的来说", "一方面...另一方面", "除此之外",
            "核心问题是", "关键在于", "我们需要"
        ],
        "场景指示词": [
            "开会", "会议开始", "现在开会", "今天会议的主要内容是", "我们来讨论一下",
            "下一个议题", "关于这个问题", "我的看法是", "大家有什么想法", "有没有补充",
            "同意的请举手", "那么我们决定", "会议到此结束", "散会", "会议室", "在线会议", "视频会议"
        ]
    },
    "备忘录": {
        "场景描述": "个人日常备忘与任务管理",
        "关键字": [
            # 任务与提醒
            "提醒我", "别忘了", "务必记住", "待办事项", "任务列表", "今日事今日毕",
            "优先处理", "紧急程度", "重要性", "截止日期", "到期提醒", "稍后处理",
            "完成", "未完成", "进行中", "已取消", "推迟",
            # 日程与计划
            "日程安排", "行程", "计划表", "预约", "会议邀请", "活动", "航班信息", "酒店预订",
            "生日提醒", "纪念日",
            # 信息记录
            "购物清单", "物品清单", "阅读清单", "电影清单",
            "电话号码", "联系方式", "邮箱地址", "网址", "地址信息",
            "账号", "密码提示", "许可证密钥", "会员信息",
            "想法", "灵感闪现", "点子", "草稿", "笔记", "随笔",
            "会议要点", "学习笔记", "食谱", "药品说明",
            # 语义连接词
            "如果...那么", "首先需要", "关键步骤", "确保", "检查一下"
        ],
        "场景指示词": [
            "记一下", "备忘", "提醒自己", "写下来", "添加到我的列表", "我的日程",
            "待办", "清单", "笔记", "记录", "草稿箱", "备忘录应用"
        ]
    },
    "通用": {
        "场景描述": "通用高频词汇和语义连接词",
        "关键字": [
            "重要", "紧急", "核心", "关键", "基本", "主要", "次要",
            "请注意", "确认", "核实", "批准", "拒绝", "同意", "反对",
            "问题", "疑问", "挑战", "机遇", "解决方案", "替代方案",
            "建议", "意见", "反馈", "请求", "通知", "公告",
            "感谢", "抱歉", "请原谅", "没关系",
            "是的", "好的", "没错", "同意", "不是", "不对", "不行", "我拒绝",
            "也许", "可能", "大概", "似乎", "应该", "必须", "需要", "一定", "绝对"
        ],
        "语义连接词": {
            "转折": ["但是", "然而", "不过", "可是", "但", "却", "反倒", "反而", "只是", "虽然", "尽管", "即便如此", "反之", "另一方面"],
            "因果": ["因为", "所以", "因此", "于是", "故", "以致", "致使", "从而", "结果", "由于", "导致", "以至于", "既然...那么...", "之所以...是因为..."],
            "并列": ["和", "与", "跟", "同", "及", "以及", "并且", "而且", "同时", "也", "还", "另外", "此外", "同样", "既...又..."],
            "递进": ["不仅", "不仅如此", "而且", "甚至", "更", "进而", "何况", "况且", "何况", "尚且...何况...", "不但...反而..."],
            "选择": ["或者", "还是", "或", "抑或", "要么...要么...", "不是...就是...", "与其...不如...", "宁可...也不..."],
            "假设": ["如果", "假如", "倘若", "要是", "一旦", "若", "假使", "如若", "万一"],
            "条件": ["只要...就...", "只有...才...", "除非...否则...", "无论...都...", "不管...也...", "任凭...也..."],
            "让步": ["虽然...但是...", "尽管...还是...", "即使...也...", "固然...但..."],
            "目的": ["为了", "以便", "旨在", "为的是", "用以", "借以"],
            "总结": ["总之", "总而言之", "综上所述", "总的来说", "总括而言", "最后", "由此可见", "一言以蔽之", "归根结底"],
            "举例": ["例如", "比如", "比方说", "好比", "诸如", "像...这样", "譬如"],
            "序列": ["首先", "其次", "然后", "接着", "之后", "最后", "起先", "后来", "第一", "第二", "第三", "一方面...另一方面..."],
            "强调": ["特别", "尤其", "确实", "正是", "无疑", "必须指出的是", "最", "尤其重要", "务必", "千万"],
            "比较": ["比...更", "较之于", "相较于", "与...相比", "同样地", "不同的是", "类似地", "相反地"],
            "指代与补充": ["这", "那", "这些", "那些", "其他", "另外", "其余", "此外", "关于", "对于", "至于"]
        }
    }
}

# 函数用于获取所有配置的关键字（包括普通关键字和语义连接词的词本身）
def get_all_keywords(config: Dict[str, Dict[str, Any]] = KEYWORDS_CONFIG) -> List[str]:
    all_kw: Set[str] = set()
    for scene_key, scene_data in config.items():
        for kw in scene_data.get("关键字", []):
            all_kw.add(kw.lower())
        if "语义连接词" in scene_data and isinstance(scene_data["语义连接词"], dict):
            for category_kws in scene_data["语义连接词"].values():
                for kw in category_kws:
                    all_kw.add(kw.lower())
    return list(all_kw)

# 函数用于获取特定场景的关键字（包括普通关键字和该场景下的语义连接词）
def get_keywords_by_scene(scene_name: str, config: Dict[str, Dict[str, Any]] = KEYWORDS_CONFIG) -> List[str]:
    keywords: Set[str] = set()
    
    # 1. 添加通用场景的关键词（除非当前就是在请求通用场景）
    if scene_name != "通用":
        generic_data = config.get("通用", {})
        # 添加通用关键词
        for kw in generic_data.get("关键字", []):
            keywords.add(kw.lower())
    
    # 2. 添加特定场景的关键词
    scene_data = config.get(scene_name)
    if scene_data:
        for kw in scene_data.get("关键字", []):
            keywords.add(kw.lower())
    
    # 3. 添加通用场景的语义连接词（对所有场景都添加）
    generic_semantic_kws = config.get("通用", {}).get("语义连接词", {})
    if isinstance(generic_semantic_kws, dict):
        for category_kws in generic_semantic_kws.values():
            for kw in category_kws:
                keywords.add(kw.lower())
    
    # 4. 添加特定场景的语义连接词（如果有的话）
    if scene_data and "语义连接词" in scene_data and isinstance(scene_data["语义连接词"], dict):
        for category_kws in scene_data["语义连接词"].values():
            for kw in category_kws:
                keywords.add(kw.lower())
            
    return list(keywords)

# 获取所有语义连接词及其分类
def get_all_semantic_keywords_with_category(config: Dict[str, Dict[str, Any]] = KEYWORDS_CONFIG) -> Dict[str, List[str]]:
    semantic_keywords_map: Dict[str, Set[str]] = {}
    generic_semantics = config.get("通用", {}).get("语义连接词", {})
    if isinstance(generic_semantics, dict):
        for category, kws in generic_semantics.items():
            if category not in semantic_keywords_map:
                semantic_keywords_map[category] = set()
            for kw in kws:
                semantic_keywords_map[category].add(kw.lower())
    
    return {cat: list(kw_set) for cat, kw_set in semantic_keywords_map.items()}


# 场景自动判断相关
def get_scene_indicator_words(config: Dict[str, Dict[str, Any]] = KEYWORDS_CONFIG) -> Dict[str, List[str]]:
    indicator_map: Dict[str, List[str]] = {}
    for scene_name, scene_data in config.items():
        if scene_name == "通用": 
            continue
        indicators = scene_data.get("场景指示词", [])
        if indicators:
            indicator_map[scene_name] = [ind.lower() for ind in indicators]
    return indicator_map

# ACTIVE_KEYWORDS 可能不再主要使用，因为关键字会根据场景动态获取
# ACTIVE_KEYWORDS: List[str] = get_all_keywords() 